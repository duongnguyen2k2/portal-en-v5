@model API.Areas.Admin.Models.Manufacturer.ManufacturerModel
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json;

@{
	Layout = "_layoutAdmin";
	if (Model.Item != null && Model.Item.Id == 0)
	{
		ViewData["Title"] = "Thêm mới Cơ sở sản xuất / Nhà vườn";
	}
	else
	{
		ViewData["Title"] = "Cập nhật Cơ sở sản xuất / Nhà vườn";
	}
	string ControllerName = this.ViewContext.RouteData.Values["controller"].ToString();
	string version = DateTime.Now.ToString("yyyyMMddhh");
}
<link rel="stylesheet" href="~/lib/tinymce/css/tinymce.css@("?v="+version )" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css@("?v="+version )">

<style>
/*	.dm-catproduct .bootstrap-select {
		width: 100% !important;
	}

		.dm-catproduct .bootstrap-select .btn-light {
			color: #212529 !important;
			border: 1px solid #ced4da !important;
			background-color: #fff;
		}

		.dm-catproduct .bootstrap-select > .dropdown-toggle.bs-placeholder {
			color: #999 !important
		}*/
</style>

<div class="card">
	<div class="card-header">
		<h4>@ViewData["Title"]</h4>
	</div>
	<div class="card-body">
		<div asp-validation-summary="All" class="text-danger"></div>
		<form asp-controller="@ControllerName" asp-action="SaveItem" method="post">
			<div class="row">
				<div class="col-12 col-md-6">
					<div class="form-group">
						<label asp-for="Item.Title">Tên <sup class="text-danger"> (*)</sup></label>
						<input type="text" class="form-control" asp-for="Item.Title" name="Title">
					</div>
				</div>

				<div class="col-12 col-md-3">
					<div class="form-group">
						<label asp-for="Item.FullName">Tên Người liên hệ</label>
						<input asp-for="Item.FullName" name="FullName" type="text" class="form-control" />
					</div>
				</div>

				<div class="col-12 col-md-3">
					<div class="form-group">
						<label asp-for="Item.Phone">Số Điện Thoại </label>
						<input asp-for="Item.Phone" name="Phone" type="text" class="form-control" />
					</div>
				</div>

				<div class="col-md-4">
					<div class="form-group d-flex flex-column dm-catproduct">
						<label asp-for="Item.List_IdProduct">Sản phẩm <sup class="text-danger"> (*)</sup></label>
						<select asp-for="Item.List_IdProduct" name="List_IdProduct" asp-items="Model.ListProduct" class="selectpicker" multiple title="Chọn Danh mục Nông sản" data-live-search="true"></select>
					</div>
				</div>

				<div class="col-12 col-md-4">
					<div class="form-group">
						<label asp-for="Item.Contact">Thông Tin Liên Hệ</label>
						<textarea asp-for="Item.Contact" name="Contact" class="form-control"></textarea>
					</div>
				</div>

				<div class="col-12 col-md-4">
					<div class="form-group">
						<label asp-for="Item.Address">Địa Chỉ</label>
						<textarea asp-for="Item.Address" name="Address" class="form-control"></textarea>
					</div>
				</div>

				<div class="col-12 col-md-4">
					<div class="form-group">
						<div class="custom-control custom-checkbox custom-control-inline">
							<input asp-for="Item.Status" name="Status" class="custom-control-input" />
							<label class="custom-control-label" asp-for="Item.Status">Trạng Thái</label>
						</div>
					</div>
				</div>

				<div class="col-lg-12">
					<div class="form-group images-main">
						<label>Hình đại diện</label>
						<img src="@Model.Item.Image" class="Item_Image_Main_Preview" style="max-height:200px;">
						<input type="hidden" name="Image" id="Item_Image_Main" class="form-control" asp-for="Item.Image">
						<a onclick="ShowManagerFile('Item_Image_Main')" class="btn btn-primary">Chọn hình (600px*400px)</a>
						<a onclick="ViewImageMain('Item_Image_Main')"> <i class="fas fa-eye"></i> Xem ảnh</a>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-12">
					<fieldset class="scheduler-border">
						<legend class="scheduler-border">File hình ảnh</legend>
						<div class="file-list">
							@if (Model.Item.ListImage != null && Model.Item.ListImage.Count() > 0)
							{
								<input type="hidden" id="maxfile" value="@(Model.Item.ListImage.Count() - 1)">
								for (int j = 0; j < Model.Item.ListImage.Count(); j++)
								{
									<div class="image-item">
										<div class="row file-item file-item-@j">
											<div class="col-lg-4">
												<input class="form-control" type="text" asp-for="@Model.Item.ListImage[j].Title" name="ListImage[@j].Title" id="FileName_Title_@j" placeholder="Tiêu đề">
											</div>
											<div class="col-lg-2">
												<input class="form-control" type="number" asp-for="@Model.Item.ListImage[j].Ordering" name="ListImage[@j].Ordering" id="FileName_Ordering_@j" placeholder="Thứ tự">
											</div>
											<div class="row col-lg-4">
												<div class="col-lg-3"><a onclick="ShowManagerFile('FileName_@j')" class="btn btn-primary">Chọn hình ảnh</a></div>
												<div class="col-lg-9"><input type="text" asp-for="@Model.Item.ListImage[j].ImagePath" name="ListImage[@j].ImagePath" class="FileName w-100" id="FileName_@j"></div>
											</div>
											<div class="col-lg-1">
												<span class="btn btn-danger xoaimage" onclick="DeleteImage('@j')"> Xóa </span>
											</div>
										</div>
									</div>
								}
							}
							else
							{
								<input type="hidden" id="maxfile" value="-1">
							}
						</div>
						<p style="margin:10px 5px; cursor:pointer" class="text-primary" onclick="AddImage()">
							<i class="fa fa-plus-square"></i> Thêm hình ảnh
						</p>
					</fieldset>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-12">
					<div class="form-group">
						<label asp-for="Item.Description">Mô tả</label>
						<textarea asp-for="Item.Description" id="full-textarea" name="Description" class="form-control"></textarea>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-12">
					<button type="submit" class="btn btn-primary" name="SaveItem" value="Lưu">
						<i class="fas fa-save"></i> Lưu lại
					</button>
					<a class="btn btn-danger" asp-controller="@ControllerName" asp-action="Index"><i class="fas fa-backward"></i> Quay Lại</a>
				</div>
			</div>

			<input type="hidden" class="form-control" asp-for="Item.Id" name="Id">
			<input type="hidden" class="form-control" asp-for="Item.Ids" name="Ids">
		</form>
	</div>
</div>

<partial name="_PartialTinymce" />
@section Scripts{
	<script src='~/lib/tinymce/tinymce.min.js@("?v="+version )' referrerpolicy="origin"></script>
	<script src='/lib/tinymce/js/tinymce_config.js@("?v="+version )' referrerpolicy="origin"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js@("?v="+version )"></script>

	<script type="text/javascript">
		var imageCount = 0;

		$(function () {
			imageCount = "@Html.Raw(Model.Item.ImageCount)";
		});

		function AddImage() {
			var max = parseInt($("#maxfile").val()) + 1;
			console.log("add:" + max);
			var str = "";
			str = '<div class="image-item">';
			str = str + '<div class="row file-item file-item-' + imageCount + '">';
			str = str + '<div class="col-lg-4"><input class="form-control" type="text" name="ListImage[' + max + '].Title" id="FileName_Title_' + max + '" placeholder="Tiêu đề"></div>';
			str = str + '<div class="col-lg-2"><input class="form-control" type="number" name="ListImage[' + max + '].Ordering" id="FileName_Ordering_' + max + '" placeholder="Thứ tự"></div>';
			str = str + '<div class="row col-lg-4"><div class="col-lg-3"><a onclick="ShowManagerFile(\'FileName_' + max + '\')" class="btn btn-primary">Chọn hình ảnh</a></div><div class="col-lg-9"><input type="text" name="ListImage[' + max + '].ImagePath" class="FileName w-100" id="FileName_' + max + '"></div></div>';
			str = str + '<div class="col-lg-1"><span class="btn btn-danger xoaimage" onclick = "DeleteImage(' + imageCount + ')" > Xóa </span></div>';
			str = str + '</div></div>'
			$(".file-list").append(str);
			$("#maxfile").val(max);
			imageCount++;
		}

		$('.file-list').on('click', '.file-item .xoaimage', function (event) {
			$(this).parent().find(".lblFileName").empty();
			$(this).parent().find(".FileName").val("");
		})

		function DeleteImage(i) {
			var getValue = document.getElementById("FileName_" + i);
			if (getValue.value != "") {
				getValue.value = "";
			}
		}
	</script>
}