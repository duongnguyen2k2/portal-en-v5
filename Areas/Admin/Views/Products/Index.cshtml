@model API.Areas.Admin.Models.Products.ProductsModel
@{
	Layout = "_layoutAdmin";
	ViewData["Title"] = "Quản lý sản phẩm";
	string ControllerName = this.ViewContext.RouteData.Values["controller"].ToString();
	string version = DateTime.Now.ToString("yyyyMMddhh");
}
<link rel="stylesheet" href="/lib/toast-jquery/jquery.toast.min.css@("?v="+version)">

<div class="container-fluid" id="app-products">
	<div class="row">
		<div class="col-12">
			<div class="page-title-box">
				<div class="page-title-right">
					<ol class="breadcrumb m-0">
						<li class="breadcrumb-item">
							<a href="/Admin">
								<i class="fas fa-home"></i> Trang Chủ
							</a>
						</li>
						<li class="breadcrumb-item active">@ViewData["Title"]</li>
					</ol>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-12">
			<div class="card">
				<div class="card-body">
					<partial name="_PartialMsgInfoAdmin" />
					<div class="row mb-2">
						<div class="col-lg-10">
							<div class="row">
								<div class="col-12 col-lg-3">
									<input type="search" class="form-control" v-on:keyup="ChangeKeyWord(event)" v-model="SearchItems.Keyword" id="SearchItems_Keyword" placeholder="Tìm kiếm...">
								</div>
								<div class="col-12 col-lg-9">
									<div class="d-flex align-items-center row">
										<div class="form-group col-lg-3">
											<select class="form-control " id="status-select" v-model="SearchItems.IdManufacturer" v-on:change="SearchChange()">												
												<template v-for="(item, index) in ListCatManufacturer" v-bind:key="item.Id">
													<option v-bind:value="item.Value">{{item.Text}}</option>
												</template>
											</select>
										</div>

										<div class="form-group col-lg-3">
											<select class="form-control " id="status-select" v-model="SearchItems.CatId" v-on:change="SearchChange()">
												<option value="-1">
													<template v-if="flagLoadingCat==true">
														Đang lấy dữ liệu ...
													</template>
													<template v-if="flagLoadingCat==false">
														Chọn Danh mục Nông sản
													</template>
												</option>
												<template v-for="(item, index) in ListCat" v-bind:key="item.Id">
													<option v-bind:value="item.Id">{{item.Title}}</option>
												</template>
											</select>
										</div>

										<div class="form-group col-lg-3">
											<select class="form-control" id="status-select" v-model="SearchItems.Status" v-on:change="SearchChange()">
												<option value="-1">--- Trạng Thái ----</option>
												<option value="1">Bật</option>
												<option value="0">Tắt</option>
											</select>
										</div>

										<div class="form-group col-lg-3 d-flex">
											<a class="btn btn-primary float-right text-white" v-on:click="SearchChange()">
												<i class="fas fa-search"></i> Tìm kiếm
											</a>
										</div>
									</div>

								</div>
							</div>
						</div>

						<div class="col-12 col-lg-2">
							<a class="btn btn-primary float-end" asp-controller="@ControllerName" asp-action="SaveItem">
								<i class="fas fa-plus"></i> Thêm mới
							</a>
						</div>

						<div class="col-12">
							<div class="table-responsive-sm">

								<table class="table table-striped table-centered mb-0">
									<thead>
										<tr>
											<th width="50px" class="text-center">STT</th>
											<th class="text-center">Code</th>
											<th class="text-center">Ảnh </th>
											<th>Tên sản phẩm</th>
											<th class="text-center">Nông sản</th>
											<th class="text-center">Trạng Thái </th>
											<th class="text-center">Nổi Bật </th>
											<th width="150px" class="btn-contain text-center">
												Thao tác
											</th>
										</tr>
									</thead>

									<tbody>
										<template v-if="flagLoading">
											<tr v-for="(item,index) in ListSkeleton" :key="item">
												<td class="skeleton-loading"><div class="skeleton-bar text-center"></div></td>
												<td class="skeleton-loading"><div class="skeleton-bar text-center"></div></td>
												<td class="skeleton-loading"><div class="skeleton-bar"></div></td>
												<td class="skeleton-loading"><div class="skeleton-bar text-center"></div></td>
												<td class="skeleton-loading"><div class="skeleton-bar text-center"></div></td>
												<td class="skeleton-loading"><div class="skeleton-bar text-center"></div></td>
												<td class="skeleton-loading"><div class="skeleton-bar text-center"></div></td>
											</tr>
										</template>
										<template v-if="!flagLoading">
											<tr v-if="ListItems.length==0">
												<td colspan="10" class="text-center">không có dữ liệu</td>
											</tr>
											<tr v-for="(item, index) in ListItems" v-bind:key="item.Id" v-bind:data-id="item.ID">
												<th width="50px" class="text-center">
													{{ (SearchItems.CurrentPage - 1) * (SearchItems.ItemsPerPage) + index + 1}}
												</th>
												<th class="text-center">{{item.Id}}</th>
												<td class="text-center">
													<img v-bind:src="item.Image" style="width:50px;" />
												</td>
												<td>
													<a v-bind:href="'/Admin/Products/SaveItem/'+item.Ids"><strong>{{item.Title}}</strong></a>
												</td>
												
												<td class="text-center">{{item.CatTitle}}</td>
												
												<td class="text-center">
													<template v-if="ListItems[index].Status==1">
														<span v-on:click="changeStatus(index)" class="fas fa-check-circle text-primary" aria-hidden="true"></span>
													</template>

													<template v-if="ListItems[index].Status==0">
														<span v-on:click="changeStatus(index)" class="far fa-times-circle text-danger" aria-hidden="true"></span>
													</template>
												</td>

												<td class="text-center">
													<template v-if="ListItems[index].Featured==1">
														<span v-on:click="changeFeatured(index)" class="fas fa-check-circle text-primary" aria-hidden="true"></span>
													</template>

													<template v-if="ListItems[index].Featured==0">
														<span v-on:click="changeFeatured(index)" class="far fa-times-circle text-danger" aria-hidden="true"></span>
													</template>
												</td>

												<td class="table-action text-center">
													<a class="action-icon text-primary" title="Sửa" v-bind:href="'/Admin/@ControllerName/SaveItem/'+item.Ids">
														<i class="far fa-edit"></i> Sửa
													</a>
													<a class="action-icon text-danger" title="Xóa" v-on:click="showDeleted(index)">
														<i class="fas fa-trash-alt"></i> Xóa
													</a>
												</td>
											</tr>

										</template>
									</tbody>

								</table>
								<form asp-controller="@ControllerName" asp-action="DeleteItem" id="AjaxDeleteForm"></form>
							</div>
						</div>

						<div class="col-12 mt-2 float-end">
							<template v-if="ListItems!=null && ListItems.length>0 && SearchItems.PageCount>0">
								<paginate v-model="SearchItems.CurrentPage"
										  :page-count="SearchItems.PageCount"
										  :page-range="3"
										  :margin-pages="2"
										  :click-handler="pageChanged"
										  :first-button-text="'Đầu'"
										  :last-button-text="'Cuối'"
										  :prev-text="'Trước'"
										  :next-text="'Sau'"
										  :first-last-button="true"
										  :container-class="'pagination pagination-rounded'"
										  :next-class="'page-item'"
										  :next-link-class="'page-link'"
										  :prev-class="'page-item'"
										  :prev-link-class="'page-link'"
										  :page-link-class="'page-link'"
										  :page-class="'page-item'">
								</paginate>
							</template>
						</div>
					</div>
				</div>

			</div>

		</div>

		<div id="copy-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="delete-modalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header modal-colored-header bg-info">
						<h4 class="modal-title" id="danger-header-modalLabel">Bạn muốn copy ?</h4>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
					</div>
					<div class="modal-body">
						Bạn muốn copy <strong>{{detailItem.Title}}</strong>?
					</div>
					<div class="modal-footer">
						<button class="btn btn-danger" type="button" disabled v-if="flagLoadingChild">
							<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
							Đang copy
						</button>
						<button type="button" class="btn btn-info" v-if="!flagLoadingChild" v-on:click="copyItem()">Copy</button>
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>

					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

		
		<div class="modal fade" id="delete-modal" tabindex="-1" role="dialog" aria-labelledby="delete-modalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-body text-center">
						<div class="p-3 text-center">
							<i class="far fa-times-circle text-danger icon-deleted"></i>
							<div class="text-3xl mt-3"> Bạn muốn xóa ?</div>
							<p class="text-slate-500 mt-2 delete-title">Bạn có chắc chắn xóa  <strong>{{deleteItem.Title}}</strong>?</p>
						</div>
						<div class="px-3 pb-8 text-center">
							<button class="btn btn-danger" type="button" disabled v-if="flagLoadingChild">
								<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
								Đang Xóa
							</button>
							<button class="btn btn-danger" v-if="!flagLoadingChild" v-on:click="deletedItem()"><i class="fas fa-trash"></i> Đồng ý</button>
							<button class="btn btn-primary" data-dismiss="modal">Thoát</button>
						</div>
					</div>
				</div>
			</div>
		</div>


	</div>



	@section Scripts{
		<script src="~/lib/js/vuejs.js@("?v="+version)"></script>
		<script src="~/lib/js/vuejs-paginate.js@("?v="+version)"></script>
		<script src="~/lib/toast-jquery/jquery.toast.min.js@("?v="+version)"></script>
		<script src="~/TemplatesAdmin/js-app/products-app.js@("?v="+version)"></script>
	}
