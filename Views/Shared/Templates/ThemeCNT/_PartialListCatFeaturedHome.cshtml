@model API.Models.Home.PartialListCatFeaturedHome;
@using Microsoft.AspNetCore.Http;
@using Newtonsoft.Json;
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@using Microsoft.AspNetCore.Mvc.Localization
@using System.Globalization;
@inject IViewLocalizer Localizer
@{
    int IdCoQuan = int.Parse(Context.Session.GetString("DomainId").ToString());
    List<API.Areas.Admin.Models.CategoriesArticles.CategoriesArticles> ListCatFeaturedHome = Model.ListCatFeaturedHome;
    List<API.Areas.Admin.Models.Articles.Articles> ListArticleByCat = new List<API.Areas.Admin.Models.Articles.Articles>();

    string StrThongTinCoQuan = Context.Session.GetString("ThongTinCoQuan");
    API.Areas.Admin.Models.DMCoQuan.DMCoQuan ItemCoQuan = new API.Areas.Admin.Models.DMCoQuan.DMCoQuan();
    ItemCoQuan = JsonConvert.DeserializeObject<API.Areas.Admin.Models.DMCoQuan.DMCoQuan>(StrThongTinCoQuan);

    int countBanner3 = 0;
    if (Model.ListBanners != null && Model.ListBanners.Count() > 0)
    {
        @for (int i = 0; i < Model.ListBanners.Count(); i++)
        {
            if (Model.ListBanners[i].CatId == 3)
            {
                countBanner3 = countBanner3 + 1;
            }
        }
    }

}
@if (ItemCoQuan.ParentId == 6 && Configuration["Security:SiteCode"] == "DLK")
{
    <partial name="Templates/_PartialLienThongHuyenCukuin" />
}else if (ItemCoQuan.ParentId == 2 && Configuration["Security:SiteCode"] == "DLK")
{
    <partial name="Templates/_PartialLienThongHuyenCumgar" />
}
else if (ItemCoQuan.ParentId == 4 && Configuration["Security:SiteCode"] == "DLK")
{
    <partial name="Templates/_PartialLienThongTPBMT" />
}
else if (ItemCoQuan.ParentId == 10 && Configuration["Security:SiteCode"] == "DLK")
{
    <partial name="Templates/_PartialLienThongHuyenEahleo" />
}
else if (ItemCoQuan.ParentId == 13 && Configuration["Security:SiteCode"] == "DLK")
{
    <partial name="Templates/_PartialLienThongHuyenKrongNang" />
}
else if (ItemCoQuan.ParentId == 14 && Configuration["Security:SiteCode"] == "DLK")
{
    <partial name="Templates/_PartialLienThongHuyenKrongPac" />
}

@if (ListCatFeaturedHome != null && ListCatFeaturedHome.Count() > 0)
{
    @for (int i = 0; i < ListCatFeaturedHome.Count(); i++)
    {
        if (countBanner3 > 0)
        {
            <section id="banner-home-top" class="">
                @if (ListCatFeaturedHome[i].Id == ItemCoQuan.PositionBannerHome)
                {
                    if (Model.ListBanners != null && Model.ListBanners.Count() > 0)
                    {
                        @for (int bn = 0; bn < Model.ListBanners.Count(); bn++)
                        {
                            if (Model.ListBanners[bn].CatId == 3)
                            {
                                <div class="baner-home-item mb-2 @(bn == 0 ? "active" : "")">
                                    <img src="@Model.ListBanners[bn].Image" alt="@Model.ListBanners[bn].Title" class="d-block w-100" loading="lazy">
                                </div>
                            }
                        }
                    }
                }
            </section>

        }



        ListArticleByCat = null;
        if (ListCatFeaturedHome[i].ParentId == 0)
        {
            ListArticleByCat = API.Areas.Admin.Models.Articles.ArticlesService.GetListNew(ListCatFeaturedHome[i].Id, 4, IdCoQuan, ListCatFeaturedHome[i].Culture);
            <div class="category-list">
                <div class="card border-0 cat-item">
                    <div class="card-header d-flex">
                        <ul class="list-inline flex-fill">
                            <li>
                                <div class="category-list-title colored">
                                    <a class="text-uppercase font-weight-bold float-left" asp-controller="Articles" asp-action="GetByCat" asp-route-id="@ListCatFeaturedHome[i].Id" asp-route-alias="@ListCatFeaturedHome[i].Alias">
                                        @if (ListCatFeaturedHome[i].Icon != null && ListCatFeaturedHome[i].Icon != "")
                                        {
                                            <span class="category-list-title-icon">@Html.Raw(ListCatFeaturedHome[i].Icon)</span>
                                        }
                                        <span class="pl-2">@ListCatFeaturedHome[i].Title</span>
                                    </a>
                                    <nav class="nav nav-underline float-left ">
                                        @for (int j = 0; j < ListCatFeaturedHome.Count(); j++)
                                        {
                                            if (ListCatFeaturedHome[j].ParentId == ListCatFeaturedHome[i].Id)
                                            {
                                                <a class="nav-link" asp-controller="Articles" asp-action="GetByCat" asp-route-id="@ListCatFeaturedHome[j].Id" asp-route-alias="@ListCatFeaturedHome[j].Alias">@ListCatFeaturedHome[j].Title</a>
                                            }
                                        }
                                    </nav>
                                </div>
                            </li>

                        </ul>
                        <ul class="list-inline flex-fill">
                            <li>
                                <div class="category-list-title pr-1">
                                    <nav class="nav nav-underline m-0 justify-content-end">
                                        <i class="fa fa-caret-right mr-2 mt-1 py-auto text-black-50" aria-hidden="true"></i>
                                        <a class="nav-link" asp-controller="Articles" asp-action="GetByCat" asp-route-id="@ListCatFeaturedHome[i].Id" asp-route-alias="@ListCatFeaturedHome[i].Alias">@Localizer["Showmore"]</a>
                                    </nav>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <div class="card-body py-1 px-0">
                        <div class="row">
                            @if (ListArticleByCat != null && ListArticleByCat.Count() > 0)
                            {
                                <div class="col-12 col-md-6 h-100">
                                    <div class="sub-article-list">
                                        <div class="flag-date-publish">
                                            <h6>@(ListArticleByCat[0].PublishUpShow.Split("/")[1].Contains("0") ? ListArticleByCat[0].PublishUpShow.Split("/")[1].Replace("0", "T") : string.Concat("T", ListArticleByCat[0].PublishUpShow.Split("/")[1]))</h6>
                                            <h6>@ListArticleByCat[0].PublishUpShow.Split("/")[0]</h6>
                                        </div>
                                        <div class="blog-item">
                                            <a class="w-100" asp-controller="Articles" asp-action="Detail" asp-route-id="@ListArticleByCat[0].Id" asp-route-alias="@ListArticleByCat[0].Alias" title="@ListArticleByCat[0].Title">
                                                <div class="image">
                                                    <img src="@ListArticleByCat[0].Images" alt="@ListArticleByCat[0].Title" loading="lazy" />
                                                    @*<span class="date">(@ListArticleByCat[0].PublishUpShow)</span>*@
                                                </div>
                                                <div class="info">
                                                    <h5 class="blog-title">@ListArticleByCat[0].Title</h5>
                                                    @*<span class="date">(@ListArticleByCat[0].PublishUpShow)</span>*@
                                                    <div class="d-none d-md-block blog-des">@ListArticleByCat[0].IntroText</div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12 col-md-6 h-100 cat-featured-home">
                                    @if (ListArticleByCat != null && ListArticleByCat.Count() > 1)
                                    {
                                        <div class="row">
                                            @for (int m = 1; m < ListArticleByCat.Count(); m++)
                                            {
                                                <div class="mb-2 col-12">
                                                    <div class="first-article-item h-100">
                                                        <div class="flag-date-publish">
                                                            <h6>@(ListArticleByCat[0].PublishUpShow.Split("/")[1].Contains("0") ? ListArticleByCat[0].PublishUpShow.Split("/")[1].Replace("0", "T") : string.Concat("T", ListArticleByCat[0].PublishUpShow.Split("/")[1]))</h6>
                                                            <h6>@ListArticleByCat[0].PublishUpShow.Split("/")[0]</h6>
                                                        </div>
                                                        <a class="d-flex" asp-controller="Articles" asp-action="Detail" asp-route-id="@ListArticleByCat[m].Id" asp-route-alias="@ListArticleByCat[m].Alias" title="@ListArticleByCat[m].Title">
                                                            <div class="img">
                                                                @if (@ListArticleByCat[m].Images == null || @ListArticleByCat[m].Images == "" || ListArticleByCat[m].Images.ToLower() == "/cms/content/tintuc/")
                                                                {
                                                                    <img src="~/images/no-image.png" class="w-100" loading="lazy">
                                                                }
                                                                else
                                                                {
                                                                    <img src="@ListArticleByCat[m].Images" class="w-100" loading="lazy">
                                                                }
                                                            </div>

                                                            <div class="first-article-body">
                                                                <p class="m-0 mb-1 title truncate-title">
                                                                    @ListArticleByCat[m].Title
                                                                </p>
                                                                <p class="m-0 cat-desc truncate-content">
                                                                    @API.Models.MyHelper.StringHelper.StringReadmore(ListArticleByCat[m].IntroText, 200)
                                                                </p>
                                                            </div>
                                                        </a>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    }
                                </div>
                            }
                        </div>

                    </div>
                </div>

            </div>
        }



    }
}