@using Microsoft.AspNetCore.Http;
@using Newtonsoft.Json;
@using API.Areas.Admin.Models.DMCoQuan;
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@using Microsoft.AspNetCore.Mvc.Localization
@using System.Globalization;
@inject IViewLocalizer Localizer
@{
    int IdCoQuan = int.Parse(Context.Session.GetString("DomainId").ToString());
    int ParentId = int.Parse(Context.Session.GetString("ParentId").ToString());
    string DomainFolderUpload = Context.Session.GetString("DomainFolderUpload").ToString();
    string ControllerName = this.ViewContext.RouteData.Values["controller"].ToString();
    string ActionName = this.ViewContext.RouteData.Values["action"].ToString();
    DMCoQuan ItemCoQuan = JsonConvert.DeserializeObject<DMCoQuan>(Context.Session.GetString("ThongTinCoQuan"));
    var ItemConfig = API.Areas.Admin.Models.SYSParams.SYSParamsService.GetItemConfigByHome(ItemCoQuan, Context);
    string SearchKey = "";
    if (this.ViewContext.HttpContext.Request.Query["keyword"].ToString() != "" && ControllerName.ToLower() == "home" && ActionName.ToLower() == "search")
    {
        SearchKey = this.ViewContext.HttpContext.Request.Query["keyword"].ToString();
    }
    List<SelectListItem> listLink = new List<SelectListItem>();//API.Areas.Admin.Models.Banners.BannersService.GetListItemsByCat(2, IdCoQuan);
    listLink.Add(new SelectListItem() { Value = "", Text = "--- Liên kết web ---" });

    // ************* ListBanners **************
    string KeySessionBanners = "Banners_" + IdCoQuan.ToString() + "-" + ParentId.ToString() + DateTime.Now.ToString("yyyyMMddhh");
    string StrListBanners = Context.Session.GetString(KeySessionBanners);

    List<API.Areas.Admin.Models.Banners.Banners> ListBanners = new List<API.Areas.Admin.Models.Banners.Banners>();

    List<API.Areas.Admin.Models.Videos.Videos> ListItemVideos = API.Areas.Admin.Models.Videos.VideosService.GetListFeatured(IdCoQuan);
    List<API.Areas.Admin.Models.Documents.Documents> ListItemDocuments = API.Areas.Admin.Models.Documents.DocumentsService.GetListNew(10, IdCoQuan);

    if (StrListBanners != null && StrListBanners != "" && ItemCoQuan.MetadataCV.FlagSession == 1)
    {
        ListBanners = JsonConvert.DeserializeObject<List<API.Areas.Admin.Models.Banners.Banners>>(StrListBanners);
    }
    else
    {
        ListBanners = API.Areas.Admin.Models.Banners.BannersService.GetList(IdCoQuan, ParentId, DomainFolderUpload);

        if (ItemCoQuan.MetadataCV.FlagSession == 1)
        {
            Context.Session.SetString(KeySessionBanners, JsonConvert.SerializeObject(ListBanners));
        }
        else
        {
            Context.Session.Remove(KeySessionBanners);
        }

    }

    // ************* End ListBanners **************

    List<SelectListItem> ListWebXa = new List<SelectListItem>();
    ListWebXa.Add(new SelectListItem() { Value = "", Text = "DANH SÁCH WEBSITE CẤP XÃ" });

    if (ListBanners != null && ListBanners.Count() > 0)
    {
        for (int bn = 0; bn < ListBanners.Count(); bn++)
        {
            if (ListBanners[bn].CatId == 11)
            {
                ListWebXa.Add(new SelectListItem() { Value = ListBanners[bn].Link, Text = ListBanners[bn].Title });
            }

            if (ListBanners[bn].CatId == 2)
            {
                listLink.Add(new SelectListItem() { Value = ListBanners[bn].Link, Text = ListBanners[bn].Title });
            }
        }
    }


    // ************* Menu Dọc **************
    string KeySessionMenuDoc = "MenuDoc_" + IdCoQuan.ToString() + "-" + ParentId.ToString() + DateTime.Now.ToString("yyyyMMddhh");
    string StrListMenuDoc = Context.Session.GetString(KeySessionMenuDoc);
    List<API.Areas.Admin.Models.Menus.Menus> ListMenuDoc = new List<API.Areas.Admin.Models.Menus.Menus>();

    if (StrListMenuDoc != null && StrListMenuDoc != "" && ItemCoQuan.MetadataCV.FlagSession == 1)
    {
        ListMenuDoc = JsonConvert.DeserializeObject<List<API.Areas.Admin.Models.Menus.Menus>>(StrListMenuDoc);
    }
    else
    {
        ListMenuDoc = API.Areas.Admin.Models.Menus.MenusService.GetListByParrent(0, IdCoQuan, 1, ParentId);
        if (ItemCoQuan.MetadataCV.FlagSession == 1)
        {
            Context.Session.SetString(KeySessionMenuDoc, JsonConvert.SerializeObject(ListMenuDoc));
        }
        else
        {
            Context.Session.Remove(KeySessionMenuDoc);
        }

    }
    // ************* End Menu Dọc **************

    string linkCss = "/Templates/" + Context.Session.GetString("TemplateName") + "/css/" + Context.Session.GetString("DomainFolderUpload") + ".css";

    if (Context.Session.GetString("DomainCssName") != null && Context.Session.GetString("DomainCssName") != "")
    {
        linkCss = "/Templates/" + Context.Session.GetString("TemplateName") + "/css/" + Context.Session.GetString("DomainCssName") + "?v=" + DateTime.Now.ToString("yyyyMMddhh");
    }

    List<API.Areas.Admin.Models.Articles.Articles> NotificationList = new List<API.Areas.Admin.Models.Articles.Articles>();
    List<API.Areas.Admin.Models.Documents.Documents> NotificationListDocument = new List<API.Areas.Admin.Models.Documents.Documents>();
    if (ItemCoQuan.ThongBao.ToLower() == "documents")
    {

        NotificationListDocument = API.Areas.Admin.Models.Documents.DocumentsService.GetListNew(8, IdCoQuan);
    }
    else
    {
        NotificationList = API.Areas.Admin.Models.Articles.ArticlesService.GetListNotification(IdCoQuan);
    }

}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    @await Html.PartialAsync("_PartialSEO", ItemConfig)
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/fonts/fonts.css" />
    <link rel="stylesheet" href="~/lib/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" href="~/lib/owl-carousel/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="~/lib/owl-carousel/css/owl.theme.default.min.css" />
    <link rel="stylesheet" href="@linkCss" />
    <link rel="stylesheet" href="~/lib/mCustomScrollbar/jquery.mCustomScrollbar.min.css" />
    <link rel="stylesheet" href="~/css/@(ItemCoQuan.FolderUpload+".css?v="+DateTime.Now.ToString("yyyyMMddhh"))" />
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script>
        window.Site = {
            CODE: "@ItemCoQuan.Code",
        }
    </script>
    @Html.Raw(ItemCoQuan.DataHeader)
</head>

<body id="main-one" class="theme-vpubnd">

    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v19.0&appId=936104813146006" nonce="f1NXEjHu"></script>

    <div class="container-wapper">

        <section id="section-header">
            <div class="container">
                <div class="row top-header">
                    
                        <partial name="Templates/@Context.Session.GetString("TemplateName")/_PartialHeaderTop" />
                        @await Html.PartialAsync("Templates/" + @Context.Session.GetString("TemplateName") + "/_PartialSlideshows", new API.Areas.Admin.Models.Banners.BannersModel() { ListItems = ListBanners })
                    
                </div>
            </div>
        </section>



        <div class="container">
            <div class="row" id="section-menu">
                <section class="col-12">
                    <partial name="Templates/@Context.Session.GetString("TemplateName")/_PartialMenu" />
                </section>
            </div>

            <div class="row" id="section-menu-mobile">
                <section class="col-12">
                    <partial name="Templates/@Context.Session.GetString("TemplateName")/_PartialCatMobile" />
                </section>
            </div>
        </div>

        <div class="container bg-white">
            @await Html.PartialAsync("Templates/" + @Context.Session.GetString("TemplateName") + "/_PartialKhauHieu", ItemConfig)
            <div class="row">

                <main class="col-center">
                    @RenderBody()
                    @await Html.PartialAsync("Templates/" + @Context.Session.GetString("TemplateName") + "/_PartialChuyenMucKhac", new API.Areas.Admin.Models.Banners.BannersModel { ListItems = ListBanners })
                </main>
                <div class="col-left">

                    <div class="card border-0" id="featured-document">
                        <div class="card-header">
                            <h3>
                                @if (ItemCoQuan.ThongBao == "Documents")
                                {
                                    <a asp-action="Index" asp-controller="Documents"><i class="fas fa-folder-open"></i> @Localizer["Notification"]</a>
                                }
                                else
                                {
                                    <a asp-action="Notification" asp-controller="Articles"><i class="fas fa-folder-open"></i> @Localizer["Notification"]</a>
                                }
                            </h3>
                        </div>
                        <div class="card-body border">
                            <div id="marquee_document_right" style="height: 365px; overflow: hidden">
                                @if (ItemCoQuan.ThongBao == "Documents")
                                {
                                    <ul >
                                        @if (NotificationListDocument != null && NotificationListDocument.Count() > 0)
                                        {


                                            @for (int i = 0; i < NotificationListDocument.Count(); i++)
                                            {
                                                <li class="mb-2">
                                                    <a asp-controller="Documents" asp-action="Detail" asp-route-id="@NotificationListDocument[i].Id" asp-route-alias="@NotificationListDocument[i].Alias" title="@NotificationListDocument[i].Title">
                                                        @NotificationListDocument[i].Title
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <ul >
                                        @if (NotificationList != null && NotificationList.Count() > 0)
                                        {


                                            @for (int i = 0; i < NotificationList.Count(); i++)
                                            {
                                                <li class="mb-2">
                                                    <a asp-controller="Articles" asp-action="Detail" asp-route-id="@NotificationList[i].Id" asp-route-alias="@NotificationList[i].Alias" title="@NotificationList[i].Title">
                                                        @NotificationList[i].Title
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                }
                            </div>
                        </div>
                    </div>

                    @if (ListWebXa != null && ListWebXa.Count() > 1)
                    {
                        <div id="link-website-xa">
                            <div class="link-website-xa-body">
                                <select name="RedirectLinkXa" id="RedirectLinkXa" class="form-control" asp-items="ListWebXa"></select>
                            </div>
                        </div>
                    }
                    <!---------Banner Left Top ---------->
                    @if (ListBanners != null && ListBanners.Count() > 0)
                    {
                        @for (int i = 0; i < ListBanners.Count(); i++)
                        {
                            if (ListBanners[i].CatId == 5)
                            {
                                <div class="banner-item">
                                    <a href="@ListBanners[i].Link" target="@ListBanners[i].Target">
                                        <img src="@ListBanners[i].Image" class="d-block w-100" title="@ListBanners[i].Title" />
                                    </a>
                                </div>
                            }

                        }
                    }

                    <div class="card card-style-two">
                        <div class="card-header">
                            <h3><a href="/van-ban.html">@Localizer["Documents"]</a></h3>
                        </div>
                        <div class="card-body p-0 m-0" id="section-documents">
                            <div id="marquee_document_right" style="height: 202px;overflow: hidden;" class="marquee_document_right">
                                <ul class="list-unstyled">
                                    @if (ListItemDocuments.Count > 0)
                                    {
                                        for (int i = 1; i < ListItemDocuments.Count(); i++)
                                        {
                                            <li>
                                                <a asp-controller="Documents" asp-action="Detail" asp-route-id="@ListItemDocuments[i].Id">
                                                    <i class="fas fa-dot-circle pr-2"></i> @ListItemDocuments[i].Title
                                                    <span class="documents-hom-date">@ListItemDocuments[i].EffectiveDateShow</span>
                                                </a>
                                            </li>
                                        }
                                    }

                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card card-style-two">
                        <div class="card-header">
                            <h3><a href="/videos.html">Videos</a></h3>
                        </div>
                        <div class="card-body p-0 m-0" id="section-videos">
                            <div id="myCarouselVideo" class="carousel slide" data-ride="carousel">
                                <!-- Wrapper for slides -->

                                <div class="carousel-inner" role="listbox">
                                    @if (ListItemVideos != null && ListItemVideos.Count() > 0)
                                    {
                                        if (ListItemVideos[0].IdType == 0)
                                        {
                                            <div class="carousel-item active" id="videos-serve">
                                                <video style="width:100%;" controls class="video-item">
                                                    <source src="@ListItemVideos[0].LinkSv" type="video/mp4">
                                                </video>
                                            </div>
                                        }
                                        else if (ListItemVideos[0].IdType == 1)
                                        {
                                            <div class="carousel-item active" id="video-youtube">
                                                <iframe style="width:100%;" src="@("https://www.youtube.com/embed/"+ListItemVideos[0].Link)" title="@ListItemVideos[0].Title" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                            </div>
                                        }
                                        else if (ListItemVideos[0].IdType == 2)
                                        {
                                            <div class="carousel-item active" id="video-youtube">
                                                <iframe style="width:100%;" src="@ListItemVideos[0].Link" title="@ListItemVideos[0].Title" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                            </div>
                                        }


                                    }
                                    else
                                    {
                                        <div class="item  active">
                                            <video style="width:100%" controls class="video-item">
                                                <source src="/CMS/Content/videos/chi-can-nu-cuoi.mp4" type="video/mp4">
                                            </video>
                                        </div>
                                    }


                                </div>
                            </div>
                            <div id="marquee_videos_top" style="height: 152px;overflow: hidden;" class="marquee_videos_top">
                                <ul class="list-unstyled">
                                    @if (ListItemVideos.Count > 1)
                                    {
                                        for (int i = 1; i < ListItemVideos.Count(); i++)
                                        {
                                            <li>
                                                <a asp-controller="Videos" asp-action="Detail" asp-route-id="@ListItemVideos[i].Id">
                                                    <i class="fas fa-dot-circle pr-2"></i> @ListItemVideos[i].Title
                                                </a>
                                            </li>
                                        }
                                    }

                                </ul>
                            </div>
                        </div>
                    </div>

                    @await Html.PartialAsync("_PartialSurvey", ItemConfig)
                       
                    <!---------Banner Right Bottom ---------->
                    @if (ListBanners != null && ListBanners.Count() > 0)
                    {
                        @for (int i = 0; i < ListBanners.Count(); i++)
                        {
                            if (ListBanners[i].CatId == 6)
                            {
                                <div class="banner-item">
                                    <a href="@ListBanners[i].Link" target="@ListBanners[i].Target">
                                        <img src="@ListBanners[i].Image" class="d-block w-100" title="@ListBanners[i].Title" />
                                    </a>
                                </div>
                            }

                        }
                    }



                    @await Html.PartialAsync("_PartialVanBanDienTu", ItemCoQuan)

                    <div class="card  card-style-one " id="link-website">
                        <div class="card-header ">
                            <h3><a>@Localizer["LinkWebTitle"]</a></h3>
                        </div>
                        <div class="card-body pl-0 pr-0">
                            <select name="RedirectLink" id="RedirectLink" class="form-control rounded-0" asp-items="listLink"></select>
                        </div>
                    </div>

                    <partial name="_PartialSiteVisit" />

                    <!---------Banner Right Bottom ---------->
                    @if (ListBanners != null && ListBanners.Count() > 0)
                    {
                        @for (int i = 0; i < ListBanners.Count(); i++)
                        {
                            if (ListBanners[i].CatId == 8)
                            {
                                <div class="banner-item">
                                    <a href="@ListBanners[i].Link" target="@ListBanners[i].Target">
                                        <img src="@ListBanners[i].Image" class="d-block w-100" title="@ListBanners[i].Title" />
                                    </a>
                                </div>
                            }

                        }
                    }

                    <div id="fanpage-facebook">
                        @Html.Raw(ItemCoQuan.MetadataCV.FacebookFanpage)
                    </div>

                </div>

            </div>


            @await Html.PartialAsync("Templates/" + @Context.Session.GetString("TemplateName") + "/_PartialMenuFooter", ItemConfig)
            @await Html.PartialAsync("Templates/" + @Context.Session.GetString("TemplateName") + "/_PartialFooter", ItemConfig)
        </div>
    </div>
    @Html.Raw(ItemCoQuan.DataFooter)

    <script src="~/lib/js/jquery.marquee.min.js?v=@DateTime.Now.ToString("yyyyMMddhh")"></script>
    <script src="~/lib/js/jquery.easing.js"></script>
    <script src="~/lib/js/popper.min.js?v=@DateTime.Now.ToString("yyyyMMddhh")"></script>
    <script src="~/lib/js/bootstrap.min.js?v=@DateTime.Now.ToString("yyyyMMddhh")"></script>
    <script src="~/lib/stellarnav/js/stellarnav.min.js"></script>
    <script src="~/lib/owl-carousel/js/owl.carousel.min.js"></script>
    <script src="~/lib/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="~/js/site.js?v=@DateTime.Now.ToString("yyyyMMddhh")"></script>


    <script src="https://sp.zalo.me/plugins/sdk.js"></script>


    <script type="text/javascript">
        jQuery('.stellarnav').stellarNav({

            breakpoint: 991,
            position: 'right',
            phoneBtn: '@ItemCoQuan.Telephone',
            closeLabel: 'Đóng'
        });
        $('.scrollWrap').mCustomScrollbar({
            theme: 'dark-3'
        });
        $('#banner-lienket-anh-body').owlCarousel({
            loop: true,
            margin: 6,
            autoplay: true,
            nav: true,
            responsive: {
                0: {
                    items: 2
                },
                600: {
                    items: 3
                },
                1000: {
                    items: 5
                }
            }
        });
        $('#new-home-body').owlCarousel({
            loop: true,
            margin: 6,
            autoplay: true,
            nav: true,
            responsive: {
                0: {
                    items: 2
                },
                600: {
                    items: 3
                },
                1000: {
                    items: 5
                }
            }
        });
    </script>

    <script>

        $('#RedirectLink').on('change', function () {
            var url = $(this).val();
            console.log(url);
            if (url) {
                window.open(url, '_blank');
            }
            return false;
        });
        $('#RedirectLinkXa').on('change', function () {
            var url = $(this).val();
            console.log(url);
            if (url) {
                window.open(url, '_blank');
            }
            return false;
        });

        $('.marquee').marquee({
            speed: 100,
            gap: 500,
            direction: 'left',
            duplicated: true,
            pauseOnHover: true
        });
        $('#marquee_document_right').marquee({
            duration: 15000,
            gap: 13,
            delayBeforeStart: 0,
            direction: 'up',
            duplicated: true,
            startVisible: true
        });

        $('#marquee_videos_top').marquee({
            duration: 15000,
            gap: 13,
            delayBeforeStart: 0,
            direction: 'up',
            duplicated: true,
            startVisible: true
        });

        $(document).ready(function () {
            $('#incfont').click(function () {
                curSize = parseInt($('body').css('font-size')) + 2;
                if (curSize <= 20)
                    $('body').css('font-size', curSize);
            });
            $('#decfont').click(function () {
                curSize = parseInt($('body').css('font-size')) - 2;
                if (curSize >= 12)
                    $('body').css('font-size', curSize);
            });
        });

        function SubmitSearch() {
            $('form#search-top').submit();
        }

        jQuery(document).ready(function () {
            jQuery('#scrollToTop').fadeOut();
            jQuery(window).scroll(function () {
                if (jQuery(window).scrollTop() != 0) {
                    jQuery('#scrollToTop').fadeIn();
                } else {
                    jQuery('#scrollToTop').fadeOut();
                }
            });
            jQuery('#scrollToTop').click(function () {
                jQuery('html, body').animate({ scrollTop: 0 }, 500);
            });
        });




    </script>

    @RenderSection("Scripts", required: false)


</body>
</html>
